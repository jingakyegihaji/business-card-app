<!doctype html>
<html lang="ko">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  emailjs.init("r-E6Bb0BR6UOFLDbb");
</script>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Business Card App (MVP)</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#2563eb;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, "ë§‘ì€ ê³ ë”•", sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{
      max-width: 1200px;
      margin: 18px auto;
      padding: 18px;
    }
    header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }
    h1{
      font-size:18px;
      margin:0;
      letter-spacing:-0.2px;
    }
    .sub{
      margin:6px 0 0;
      color:var(--muted);
      font-size:12px;
    }

    .grid{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:16px;
    }

    .panel{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }
    .panel h2{
      margin:0 0 10px;
      font-size:14px;
    }

    .row{display:flex; gap:10px; align-items:center; margin:10px 0;}
    label{font-size:12px; color:var(--muted); width:110px;}
    select,input{
      width:100%;
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px 10px;
      outline:none;
      background:#fff;
      font-size:13px;
    }
    input:focus, select:focus{border-color:#bcd3ff; box-shadow:0 0 0 3px rgba(37,99,235,0.12)}

    .btns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    button{
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    button.primary{
      background:var(--accent);
      border-color:var(--accent);
      color:#fff;
    }
    button:active{transform:translateY(1px)}
    button:disabled{
      opacity:0.55;
      cursor:not-allowed;
    }

    .hint{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
    }

    /* Preview */
    .previewWrap{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .previewHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .badge{
      font-size:12px;
      color:var(--muted);
    }

    /* ëª…í•¨ ì‹¤ì œ ë¹„ìœ¨: 90x50mm => 1.8:1 */
    #preview{
      width: 720px;              /* í™”ë©´ìš© í¬ê¸° (ìº¡ì²˜ ì‹œ scaleë¡œ ê³ í•´ìƒë„ í™•ë³´) */
      aspect-ratio: 90 / 50;
      border-radius:18px;
      border:1px solid var(--line);
      background: linear-gradient(135deg, #0b1220, #111827);
      position:relative;
      overflow:hidden;
      box-shadow: 0 16px 40px rgba(0,0,0,0.16);
    }
    /* fallback ë°°ê²½ (ì´ë¯¸ì§€ ì—†ì„ ë•Œ) */
    #preview::before{
      content:"";
      position:absolute; inset:-40px;
      background:
        radial-gradient(circle at 20% 30%, rgba(37,99,235,0.55), transparent 45%),
        radial-gradient(circle at 70% 60%, rgba(16,185,129,0.38), transparent 46%),
        radial-gradient(circle at 40% 80%, rgba(249,115,22,0.28), transparent 50%);
      filter: blur(2px);
      opacity:0.9;
      pointer-events:none;
    }

    .field{
      position:absolute;
      white-space:pre;
      transform-origin: left top;
      color:#fff;
      text-shadow: 0 2px 10px rgba(0,0,0,0.25);
      user-select:none;
    }

    /* ìº¡ì²˜í•  ë•Œ ë²„íŠ¼/ê°€ì´ë“œê°€ ì„ì´ì§€ ì•Šê²Œ: preview ì•ˆì—ëŠ” ì¶œë ¥ ìš”ì†Œë§Œ ë‘ê¸° */
    .cornerMark{
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:0.16;
      background:
        linear-gradient(#fff,#fff) left 16px top 16px / 24px 2px no-repeat,
        linear-gradient(#fff,#fff) left 16px top 16px / 2px 24px no-repeat,

        linear-gradient(#fff,#fff) right 16px top 16px / 24px 2px no-repeat,
        linear-gradient(#fff,#fff) right 16px top 16px / 2px 24px no-repeat,

        linear-gradient(#fff,#fff) left 16px bottom 16px / 24px 2px no-repeat,
        linear-gradient(#fff,#fff) left 16px bottom 16px / 2px 24px no-repeat,

        linear-gradient(#fff,#fff) right 16px bottom 16px / 24px 2px no-repeat,
        linear-gradient(#fff,#fff) right 16px bottom 16px / 2px 24px no-repeat;
    }

    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background:#111827;
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:12px;
      box-shadow:0 12px 30px rgba(0,0,0,0.25);
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease;
    }
    .toast.show{opacity:1;}
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      #preview{width:100%}
      label{width:95px}
    }
  </style>

  <!-- ìº¡ì²˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ëª…í•¨ ì£¼ë¬¸ MVP</h1>
        <p class="sub">í…œí”Œë¦¿ â†’ JSON ì¢Œí‘œ ë°°ì¹˜ â†’ ì…ë ¥ ì¦‰ì‹œ ë°˜ì˜ â†’ ì´ì œ â€œìº¡ì²˜ ì €ì¥â€ ë¶™ì´ê¸° âœ¨</p>
      </div>
      <div class="badge">Client-side capture (no server render)</div>
    </header>

    <div class="grid">
      <!-- Left: Controls -->
      <section class="panel">
        <h2>ì„¤ì •</h2>

        <div class="row">
          <label for="templateSel">í…œí”Œë¦¿</label>
          <select id="templateSel"></select>
        </div>

        <div class="row">
          <label for="nameInput">ì´ë¦„</label>
          <input id="nameInput" placeholder="í™ê¸¸ë™" value="í™ê¸¸ë™"/>
        </div>

        <div class="row">
          <label for="titleInput">ì§í•¨</label>
          <input id="titleInput" placeholder="Sales Manager" value="Sales Manager"/>
        </div>

        <div class="row">
          <label for="companyInput">íšŒì‚¬</label>
          <input id="companyInput" placeholder="ACME Inc." value="ACME Inc."/>
        </div>

        <div class="row">
          <label for="phoneInput">ì „í™”</label>
          <input id="phoneInput" placeholder="+82 10-1234-5678" value="+82 10-1234-5678"/>
        </div>

        <div class="row">
          <label for="emailInput">ì´ë©”ì¼</label>
          <input id="emailInput" placeholder="hello@example.com" value="hello@example.com"/>
        </div>

        <div class="btns">
           <button class="primary" id="btnSend">ì „ì†¡í•˜ê¸°</button>

        </div>

        <div class="hint">
          - PNGëŠ” í™”ë©´ì— ë³´ì´ëŠ” ë¯¸ë¦¬ë³´ê¸°ë¥¼ ê·¸ëŒ€ë¡œ ì €ì¥í•©ë‹ˆë‹¤.<br/>
          - PDFëŠ” <b>90Ã—50mm</b>ë¡œ ì €ì¥ë˜ë©°, í”„ë¦°íŠ¸/ë””ìì´ë„ˆ í™•ì¸ìš©ìœ¼ë¡œ ë”± ì¢‹ì•„ìš”.<br/>
          - ì´ë¯¸ì§€ ì—…ë¡œë“œê°€ ì—†ì–´ë„ fallback ë°°ê²½ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
        </div>
      </section>

      <!-- Right: Preview -->
      <section class="previewWrap">
        <div class="previewHeader">
          <div class="badge">Preview (#preview)</div>
          <div class="badge" id="sizeInfo">90Ã—50mm</div>
        </div>

        <div id="preview" aria-label="business card preview">
          <div class="cornerMark" aria-hidden="true"></div>
          <!-- fields injected here -->
        </div>
      </section>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
  /***********************
   * 1) í…œí”Œë¦¿ & ë Œë”
   ***********************/
  const templates = [
    {
      id: "classic_dark",
      name: "Classic Dark",
      style: {},
      fields: {
        company:{ x: 50,  y: 76,  fontSize: 26, fontWeight: 600, opacity: 0.95, align:"left" },
        name:   { x: 48,  y: 150, fontSize: 44, fontWeight: 700, letterSpacing: 0.2, align:"left" },
        title:  { x: 50,  y: 208, fontSize: 22, fontWeight: 400, opacity: 0.9, align:"left" },
        phone:  { x: 50,  y: 300, fontSize: 20, fontWeight: 400, opacity: 0.9, align:"left" },
        email:  { x: 50,  y: 330, fontSize: 20, fontWeight: 400, opacity: 0.9, align:"left" },
      }
    },
    {
      id: "minimal_light",
      name: "Minimal Light",
      style: { lightBg: true },
      fields: {
        company:{ x: 58,  y: 88,  fontSize: 26, fontWeight: 600, color:"#111827", textShadow:"none", align:"left" },
        name:   { x: 56,  y: 170, fontSize: 44, fontWeight: 700, color:"#111827", textShadow:"none", align:"left" },
        title:  { x: 58,  y: 228, fontSize: 22, fontWeight: 400, color:"#374151", textShadow:"none", align:"left" },
        phone:  { x: 58,  y: 304, fontSize: 20, fontWeight: 400, color:"#374151", textShadow:"none", align:"left" },
        email:  { x: 58,  y: 334, fontSize: 20, fontWeight: 400, color:"#374151", textShadow:"none", align:"left" },
      }
    }
  ];

  const elTemplateSel = document.getElementById("templateSel");
  const elPreview = document.getElementById("preview");

  const inputs = {
    name: document.getElementById("nameInput"),
    title: document.getElementById("titleInput"),
    company: document.getElementById("companyInput"),
    phone: document.getElementById("phoneInput"),
    email: document.getElementById("emailInput"),
  };

  function populateTemplates(){
    elTemplateSel.innerHTML = templates.map(t => `<option value="${t.id}">${t.name}</option>`).join("");
    elTemplateSel.value = templates[0].id;
  }

  function getActiveTemplate(){
    return templates.find(t => t.id === elTemplateSel.value) || templates[0];
  }

  function applyTemplateStyle(tpl){
    if (tpl.style && tpl.style.lightBg){
      elPreview.style.background = "linear-gradient(135deg, #ffffff, #f3f4f6)";
      elPreview.style.boxShadow = "0 16px 40px rgba(0,0,0,0.10)";
    } else {
      elPreview.style.background = "linear-gradient(135deg, #0b1220, #111827)";
      elPreview.style.boxShadow = "0 16px 40px rgba(0,0,0,0.16)";
    }
  }

  function renderPreview(){
    const tpl = getActiveTemplate();
    applyTemplateStyle(tpl);

    elPreview.querySelectorAll(".field").forEach(n => n.remove());

    const values = {
      name: inputs.name.value || "",
      title: inputs.title.value || "",
      company: inputs.company.value || "",
      phone: inputs.phone.value || "",
      email: inputs.email.value || ""
    };

    Object.entries(tpl.fields).forEach(([key, spec]) => {
      const div = document.createElement("div");
      div.className = "field";
      div.dataset.key = key;
      div.textContent = values[key] ?? "";

      // íë¦¿í•¨ ë°©ì§€: ì •ìˆ˜ë¡œ ìŠ¤ëƒ…
      div.style.left = Math.round(spec.x ?? 0) + "px";
      div.style.top  = Math.round(spec.y ?? 0) + "px";
      div.style.fontSize = Math.round(spec.fontSize ?? 18) + "px";

      div.style.fontWeight = (spec.fontWeight ?? 400);
      div.style.opacity = (spec.opacity ?? 1);
      div.style.letterSpacing = (spec.letterSpacing ?? 0) + "px";
      div.style.textAlign = spec.align || "left";
      if (spec.color) div.style.color = spec.color;
      if (spec.textShadow) div.style.textShadow = spec.textShadow;

      elPreview.appendChild(div);
    });
  }

  /***********************
   * 2) ì „ì†¡ (ê³ ì • ì´ë©”ì¼ë¡œ PDF ì „ì†¡)
   ***********************/
  const btnSend = document.getElementById("btnSend");

  async function makePdfBlobFromPreview() {
    const canvas = await html2canvas(elPreview, { scale: 3, useCORS: true });
    const imgData = canvas.toDataURL("image/png");
    const { jsPDF } = window.jspdf;

    const pdf = new jsPDF({
      orientation: "landscape",
      unit: "mm",
      format: [90, 50]
    });

    pdf.addImage(imgData, "PNG", 0, 0, 90, 50);
    return pdf.output("blob");
  }

  const btnSend = document.getElementById("btnSend");

function blobToBase64(blob) {
  return new Promise((resolve, reject) => {
    const r = new FileReader();
    r.onload = () => resolve(r.result);
    r.onerror = reject;
    r.readAsDataURL(blob);
  });
}

async function makePdfBlobFromPreview() {
  const canvas = await html2canvas(document.querySelector("#preview"), {
    scale: 3,
    useCORS: true
  });

  const imgData = canvas.toDataURL("image/png");
  const { jsPDF } = window.jspdf;

  const pdf = new jsPDF({
    orientation: "landscape",
    unit: "mm",
    format: [90, 50]
  });

  pdf.addImage(imgData, "PNG", 0, 0, 90, 50);
  return pdf.output("blob");
}

btnSend.addEventListener("click", async () => {
  btnSend.disabled = true;

  try {
    const pdfBlob = await makePdfBlobFromPreview();
    const pdfDataUrl = await blobToBase64(pdfBlob);

    const payload = {
      customer_name: inputs.name.value.trim(),
      customer_title: inputs.title.value.trim(),
      customer_company: inputs.company.value.trim(),
      customer_phone: inputs.phone.value.trim(),
      customer_email: inputs.email.value.trim(),
      pdf_base64: pdfDataUrl
    };

    // ğŸ”´ ì—¬ê¸° 2ì¤„ì´ â€œêµì²´ ëŒ€ìƒâ€
    const SERVICE_ID = "service_6gyisv8";
    const TEMPLATE_ID = "template_1bls7qs";

    await emailjs.send(SERVICE_ID, TEMPLATE_ID, payload);

    alert("ì „ì†¡ ì™„ë£Œ! ahsvic@naver.com ìœ¼ë¡œ ë©”ì¼ì„ ë³´ëƒˆì–´ìš”.");
  } catch (e) {
    console.error(e);
    alert("ì „ì†¡ ì‹¤íŒ¨: " + (e?.text || e?.message || String(e)));
  } finally {
    btnSend.disabled = false;
  }
});


  /***********************
   * ì´ˆê¸°í™”
   ***********************/
  populateTemplates();
  renderPreview();
  elTemplateSel.addEventListener("change", renderPreview);
  Object.values(inputs).forEach(inp => inp.addEventListener("input", renderPreview));
</script>

</body>
</html>
